<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Fragen hochladen</title>
        <style>
            textarea {
                display: block;
                width: 25vw;
                height: 16vh;
            }

            label {
                display: block;
            }

            input[type=text] {
                display: block;
                margin: 0 0 0.5em 0;
            }
        </style>
    </head>
    <body>
        
        <form id="questionUploadForm">
            <textarea id="questionContent"></textarea>

            <label for="topicBlock">Themenbereich</label>
            <select id="topicBlock">
                <option value="1">Web</option>
                <option value="2">Game</option>
                <option value="3">Art</option>
            </select>

            <label for="topic">Thema</label>
            <select id="topic">
                <!-- Web -->
                <option value="1">HTML und CSS</option>
                <option value="2">JavaScript</option>
                <option value="3">PHP und MySQL</option>

                <!-- Game -->
                <option value="4">Unity</option>
                <option value="5">C#</option>
                <option value="6">MonoGame</option>

                <!-- Art-->
                <option value="7">Photoshop</option>
                <option value="8">Blender</option>
                <option value="9">Premiere</option>
            </select>

            <label for="answer_01">Falsche Antwort 1:</label>
            <input type="text" id="answer_01" />

            <label for="answer_02">Falsche Antwort 2:</label>
            <input type="text" id="answer_02" />

            <label for="answer_03">Falsche Antwort 2:</label>
            <input type="text" id="answer_03" />

            <label for="answer_04">Richtige Antwort:</label>
            <input type="text" id="answer_04" />

            <button type="submit">Abschicken!</button>
        </form>

        <script>
            (function () {

                let form = document.getElementById('questionUploadForm');
                let textArea = document.getElementById('questionContent');
                let wrongAnswer01 = document.getElementById('answer_01');
                let wrongAnswer02 = document.getElementById('answer_02');
                let wrongAnswer03 = document.getElementById('answer_03');
                let correctAnswer = document.getElementById('answer_04');
                let topicBlockSelect = document.getElementById('topicBlock');
                let topicSelect = document.getElementById('topic');

                form.onsubmit = function (e) {
                    e.preventDefault();

                    let data = {
                        content: textArea.value,
                        wrongAnswer01: wrongAnswer01.value,
                        wrongAnswer02: wrongAnswer02.value,
                        wrongAnswer03: wrongAnswer03.value,
                        correctAnswer: correctAnswer.value,
                        topicBlockId: topicBlockSelect.options[topicBlockSelect.selectedIndex].value,
                        topicId: topicSelect.options[topicSelect.selectedIndex].value
                    };

                    let xhr = new XMLHttpRequest();

                    xhr.open('POST', 'http://localhost/add-question');

                    xhr.setRequestHeader('Content-Type', 'application/json');

                    xhr.onload = function () {
                        let response = JSON.parse(this.responseText);

                        if (response.success === true) {
                            // kein fehler
                            let reset = confirm('Hat geklappt! Formular resetten?');

                            if (reset === true) {
                                textArea.value = '';
                                wrongAnswer01.value = '';
                                wrongAnswer02.value = '';
                                wrongAnswer03.value = '';
                                correctAnswer.value = '';
                            }
                        } else {
                            alert(`Ein Fehler ist aufgetreten: ${response.error}`);
                        }

                    };

                    xhr.send(JSON.stringify(data));
                };

            })();
        </script>
    </body>
</html>